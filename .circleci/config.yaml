version: 2.1
orbs:
  python: circleci/python@2.0.3




jobs:
    build:
      deploy:
        executor: python/default
        machine:
            enabled: true
        steps:
            - checkout
            - run:
                name: Install Dependencies
                command: pip install -r requirements.txt
            - persist_to_workspace:
                root: .
                paths:
                    - .
            - run:
                name: Deploy Over SSH
                command: ssh root@170.64.180.130 'bash -s' < run.sh

workflows:
    build-and-deploy:
    jobs:
        - build
        - deploy:
            requires:
            - build # only deploy once build job has completed
            filters:
              branches:
                  only: main # only deploy on the main branch